
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Realtime setup Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="realtime-examples.html" />
    
    
    <link rel="prev" href="browsers-mobile-devices.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../step-by-step/readme.html">
            
                <a href="../step-by-step/readme.html">
            
                    
                    Step by step intro to basic Feathers >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../step-by-step/intro/readme.html">
            
                <a href="../step-by-step/intro/readme.html">
            
                    
                    Introduction >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../step-by-step/intro/not-worry.html">
            
                <a href="../step-by-step/intro/not-worry.html">
            
                    
                    What not to worry about
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../step-by-step/basic-feathers/readme.html">
            
                <a href="../step-by-step/basic-feathers/readme.html">
            
                    
                    Basic Feathers >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../step-by-step/basic-feathers/database-connector.html">
            
                <a href="../step-by-step/basic-feathers/database-connector.html">
            
                    
                    A database connector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../step-by-step/basic-feathers/rest-api-server.html">
            
                <a href="../step-by-step/basic-feathers/rest-api-server.html">
            
                    
                    A REST API server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../step-by-step/basic-feathers/rest-client.html">
            
                <a href="../step-by-step/basic-feathers/rest-client.html">
            
                    
                    A Feathers REST client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../step-by-step/basic-feathers/socket-client.html">
            
                <a href="../step-by-step/basic-feathers/socket-client.html">
            
                    
                    A Feathers websocket client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../step-by-step/basic-feathers/ah-ha.html">
            
                <a href="../step-by-step/basic-feathers/ah-ha.html">
            
                    
                    The "ah-ha" moment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../step-by-step/basic-feathers/hooks-1.html">
            
                <a href="../step-by-step/basic-feathers/hooks-1.html">
            
                    
                    Hooks, part 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.7" data-path="../step-by-step/basic-feathers/hooks-2.html">
            
                <a href="../step-by-step/basic-feathers/hooks-2.html">
            
                    
                    Hooks, part 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.8" data-path="../step-by-step/basic-feathers/real-time.html">
            
                <a href="../step-by-step/basic-feathers/real-time.html">
            
                    
                    Real-time
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../step-by-step/generators/readme.html">
            
                <a href="../step-by-step/generators/readme.html">
            
                    
                    Generators >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../step-by-step/generators/app.html">
            
                <a href="../step-by-step/generators/app.html">
            
                    
                    Generating an app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../step-by-step/generators/service.html">
            
                <a href="../step-by-step/generators/service.html">
            
                    
                    Adding a service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../step-by-step/what-next.html">
            
                <a href="../step-by-step/what-next.html">
            
                    
                    What's next?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../step-by-step/production-ready.html">
            
                <a href="../step-by-step/production-ready.html">
            
                    
                    Is Feathers production ready?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../step-by-step/appendix/readme.html">
            
                <a href="../step-by-step/appendix/readme.html">
            
                    
                    Appendix >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../step-by-step/appendix/what-is-this.html">
            
                <a href="../step-by-step/appendix/what-is-this.html">
            
                    
                    What is 'this'?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../chat/readme.html">
            
                <a href="../chat/readme.html">
            
                    
                    Writing a chat room app >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../chat/server/readme.html">
            
                <a href="../chat/server/readme.html">
            
                    
                    Server >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../chat/server/start-server.html">
            
                <a href="../chat/server/start-server.html">
            
                    
                    Starting the server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../chat/server/start-front-end.html">
            
                <a href="../chat/server/start-front-end.html">
            
                    
                    Starting the front-end
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../chat/server/finish-server.html">
            
                <a href="../chat/server/finish-server.html">
            
                    
                    Finishing the server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../chat/server/user-mgnt.html">
            
                <a href="../chat/server/user-mgnt.html">
            
                    
                    User management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../chat/client/readme.html">
            
                <a href="../chat/client/readme.html">
            
                    
                    Client >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../chat/client/jQuery.html">
            
                <a href="../chat/client/jQuery.html">
            
                    
                    jQuery client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../chat/client/webpack.html">
            
                <a href="../chat/client/webpack.html">
            
                    
                    Using Webpack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../chat/client/oauth.html">
            
                <a href="../chat/client/oauth.html">
            
                    
                    OAuth jQuery client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../chat/client/other-clients.html">
            
                <a href="../chat/client/other-clients.html">
            
                    
                    Clients for other frameworks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../chat/what-next.html">
            
                <a href="../chat/what-next.html">
            
                    
                    What's next?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../adapters/readme.html">
            
                <a href="../adapters/readme.html">
            
                    
                    Adapters >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../adapters/redux-services/readme.html">
            
                <a href="../adapters/redux-services/readme.html">
            
                    
                    Redux for Feathers services >>
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../adapters/redux-auth/readme.html">
            
                <a href="../adapters/redux-auth/readme.html">
            
                    
                    Redux for Feathers authentication >>
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    Offline
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="strategies.html">
            
                <a href="strategies.html">
            
                    
                    Strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="snapshot.html">
            
                <a href="snapshot.html">
            
                    
                    snapshot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="realtime.html">
            
                <a href="realtime.html">
            
                    
                    realtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="owndata-ownnet.html">
            
                <a href="owndata-ownnet.html">
            
                    
                    own-data & own-net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="syncdata-syncnet.html">
            
                <a href="syncdata-syncnet.html">
            
                    
                    sync-data & sync-net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="database-records.html">
            
                <a href="database-records.html">
            
                    
                    Database records
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="publications.html">
            
                <a href="publications.html">
            
                    
                    Publications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="filtering.html">
            
                <a href="filtering.html">
            
                    
                    Filtering service events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="browsers-mobile-devices.html">
            
                <a href="browsers-mobile-devices.html">
            
                    
                    Browsers & mobile devices
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.10" data-path="realtime-setup.html">
            
                <a href="realtime-setup.html">
            
                    
                    Realtime setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="realtime-examples.html">
            
                <a href="realtime-examples.html">
            
                    
                    Realtime examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="own-data-setup.html">
            
                <a href="own-data-setup.html">
            
                    
                    own-data setup
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Realtime setup</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="realtime-setup">Realtime setup</h1>
<p>| <strong>Let&apos;s show the code needed for the realtime strategy.</strong></p>
<p>Realtime starts with a snapshot of the remote database data.
Subsequent data changes made at the remote are delivered to the client as they occur in near real time.
The data changes are applied at the client in the same order as they occurred at the remote.</p>
<p>Replication stops when communication is lost with the server.
It can be restarted on reconnection.</p>
<h2 id="replicate-the-entire-file">Replicate the entire file</h2>
<p>The client service will contain all the same records as the remote service.
All service events are emitted to the client, because they are all required.</p>
<h5 id="server-code">Server code</h5>
<p>Register application-level hook.
Its required for replicated remote services,
and will not affect ones not being replicated.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { client } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

app.hooks({
  before: client(<span class="hljs-string">&apos;_offline&apos;</span>)
});
</code></pre>
<h5 id="client-code">Client code</h5>
<p>Attach a hook to each replicated local service:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { client } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-built_in">module</span>.exports = { <span class="hljs-comment">// &apos;client-service&apos;</span>
  before: {
    all: client(<span class="hljs-string">&apos;_offline&apos;</span>)
  }
};
</code></pre>
<p>Configure the replication and start it:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> realtime = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/realtime&apos;</span>);

<span class="hljs-keyword">const</span> replicator = realtime({
  name: <span class="hljs-string">&apos;foo&apos;</span>,
  app: clientApp,
  remoteServiceName: <span class="hljs-string">&apos;remote-service&apos;</span>,
  clientServiceName: <span class="hljs-string">&apos;client-service&apos;</span>,
});

replicator.subscribe()
  .then(() =&gt; ...)
</code></pre>
<h5 id="example">Example</h5>
<p>You can run an example using this strategy.</p>
<pre><code class="lang-text">cd path/to/feathers-mobile/examples
npm install
cd ./realtime-1
npm run build
npm start
</code></pre>
<p>Then point a browser at <code>localhost:3030</code>.</p>
<p>A snapshot of the remote service is made to the client when replication starts.</p>
<pre><code class="lang-text">===== remoteService, before mutations
{dept: &quot;a&quot;, stock: &quot;a1&quot;, _id: &quot;JdYINLVZkU70vcgL&quot;}
{dept: &quot;a&quot;, stock: &quot;a2&quot;, _id: &quot;X6ymJYOqYWLe3KHj&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, _id: &quot;p1zZviQzhAed2jMd&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, _id: &quot;cE9ujfWFHTjNh4px&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, _id: &quot;fyyErGpn8Hk2Q5EY&quot;}
===== clientService, before mutations
{dept: &quot;a&quot;, stock: &quot;a1&quot;, ___id: &quot;JdYINLVZkU70vcgL&quot;, _id: &quot;A29Urf0WmOfjV8W6&quot;}
{dept: &quot;a&quot;, stock: &quot;a2&quot;, ___id: &quot;X6ymJYOqYWLe3KHj&quot;, _id: &quot;RuZlujc09it23Ikx&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, ___id: &quot;p1zZviQzhAed2jMd&quot;, _id: &quot;Y1SuSBXUB659vEWm&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, ___id: &quot;cE9ujfWFHTjNh4px&quot;, _id: &quot;I7s4gsQTFtUZPyUt&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, ___id: &quot;fyyErGpn8Hk2Q5EY&quot;, _id: &quot;agzsMMxP04EhMksH&quot;}
</code></pre>
<p>We can simulate other people changing data on the remote service.</p>
<pre><code class="lang-text">===== mutate remoteService
remoteService.patch stock: a1
remoteService.create stock: a99
remoteService.remove stock: a2
</code></pre>
<p>The mutations are replicated to the client.</p>
<pre><code class="lang-text">===== remoteService, after mutations
{dept: &quot;a&quot;, stock: &quot;a1&quot;, _id: &quot;JdYINLVZkU70vcgL&quot;, foo: 1}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, _id: &quot;p1zZviQzhAed2jMd&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, _id: &quot;cE9ujfWFHTjNh4px&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, _id: &quot;fyyErGpn8Hk2Q5EY&quot;}
{dept: &quot;a&quot;, stock: &quot;a99&quot;, _id: &quot;1VD0hWlkfaZdDBt0&quot;}
===== clientService, after mutations
{dept: &quot;a&quot;, stock: &quot;a1&quot;, foo: 1, ___id: &quot;JdYINLVZkU70vcgL&quot;, _id: &quot;A29Urf0WmOfjV8W6&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, ___id: &quot;p1zZviQzhAed2jMd&quot;, _id: &quot;Y1SuSBXUB659vEWm&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, ___id: &quot;cE9ujfWFHTjNh4px&quot;, _id: &quot;I7s4gsQTFtUZPyUt&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, ___id: &quot;fyyErGpn8Hk2Q5EY&quot;, _id: &quot;agzsMMxP04EhMksH&quot;}
{dept: &quot;a&quot;, stock: &quot;a99&quot;, ___id: &quot;1VD0hWlkfaZdDBt0&quot;, _id: &quot;NkBp4yXfitEauNh1&quot;}
</code></pre>
<p>We can simulate a lost connection, after which other people mutate more data.</p>
<pre><code class="lang-javascript">replicator.connection.disconnected();
</code></pre>
<pre><code class="lang-text">&gt;&gt;&gt;&gt;&gt; disconnection from server
===== mutate remoteService
remoteService.patch stock: a3
remoteService.create stock: a98
remoteService.remove stock: a5
</code></pre>
<p>After we simulate a reconnection, the client service is brought up to data with a snapshot.</p>
<pre><code class="lang-javascript">replicator.connection.reconnected();
</code></pre>
<pre><code class="lang-text">&lt;&lt;&lt;&lt;&lt; reconnected to server
===== remoteService, after reconnection
{dept: &quot;a&quot;, stock: &quot;a1&quot;, _id: &quot;JdYINLVZkU70vcgL&quot;, foo: 1}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, _id: &quot;p1zZviQzhAed2jMd&quot;, foo: 1}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, _id: &quot;cE9ujfWFHTjNh4px&quot;}
{dept: &quot;a&quot;, stock: &quot;a98&quot;, _id: &quot;zd7o0ulMagYjyGBo&quot;}
{dept: &quot;a&quot;, stock: &quot;a99&quot;, _id: &quot;1VD0hWlkfaZdDBt0&quot;}
===== clientService, after reconnection
{dept: &quot;a&quot;, stock: &quot;a1&quot;, foo: 1, ___id: &quot;JdYINLVZkU70vcgL&quot;, _id: &quot;sQ8LYLXMO2wK8VQC&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, foo: 1, ___id: &quot;p1zZviQzhAed2jMd&quot;, _id: &quot;prAZ8yJjLJw0GAfG&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, ___id: &quot;cE9ujfWFHTjNh4px&quot;, _id: &quot;1M2xDGBpQL201hfK&quot;}
{dept: &quot;a&quot;, stock: &quot;a98&quot;, ___id: &quot;zd7o0ulMagYjyGBo&quot;, _id: &quot;DgWgc3vA8z0fewaf&quot;}
{dept: &quot;a&quot;, stock: &quot;a99&quot;, ___id: &quot;1VD0hWlkfaZdDBt0&quot;, _id: &quot;WAFFfnvvnTDaUDwi&quot;}
===== Example finished.
</code></pre>
<h2 id="replicate-part-of-a-file">Replicate part of a file</h2>
<p>The client service will contain those records on the remote service
which satisfy a publication&apos;s criteria.
All service events are emitted to the client,
where they are checked against the publication.</p>
<h5 id="server-code">Server code</h5>
<p>Register application-level hook.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// No change from previous example</span>
<span class="hljs-keyword">const</span> { client } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
app.hooks({ before: client(<span class="hljs-string">&apos;_offline&apos;</span>) });
</code></pre>
<h5 id="client-code">Client code</h5>
<p>Attach hook to each replicated local service:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// No change from previous example</span>
<span class="hljs-keyword">const</span> { client } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
<span class="hljs-built_in">module</span>.exports = { before: { all: client(<span class="hljs-string">&apos;_offline&apos;</span>) } };
</code></pre>
<p>Configure the replication, with a publication to identify the desired records, and then start it:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> commonPublications = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/common/commonPublications&apos;</span>);
<span class="hljs-keyword">const</span> realtime = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/realtime&apos;</span>);

<span class="hljs-keyword">const</span> replicator = realtime({
  name: <span class="hljs-string">&apos;foo&apos;</span>,
  app: clientApp,
  remoteServiceName: <span class="hljs-string">&apos;remote-service&apos;</span>,
  clientServiceName: <span class="hljs-string">&apos;client-service&apos;</span>,
  publication: { <span class="hljs-comment">// new option</span>
    <span class="hljs-built_in">module</span>: commonPublications, name: <span class="hljs-string">&apos;query&apos;</span>, params: { dept: <span class="hljs-string">&apos;a&apos;</span>
  },
});

replicator.subscribe()
  .then(() =&gt; ...)
</code></pre>
<h5 id="example">Example</h5>
<p>You can run an example using this strategy.</p>
<pre><code class="lang-text">cd path/to/feathers-mobile/examples
npm install
cd ./realtime-2
npm run build
npm start
</code></pre>
<p>Then point a browser at <code>localhost:3030</code>.</p>
<p>When replication starts,
a snapshot of those records in the remote service which satisfy the publication
is made to the client.</p>
<pre><code class="lang-javascript">publication: {
  <span class="hljs-built_in">module</span>: commonPublications, name: <span class="hljs-string">&apos;query&apos;</span>, params: { dept: <span class="hljs-string">&apos;a&apos;</span> }
}
</code></pre>
<pre><code class="lang-text">===== remoteService, before mutations
{dept: &quot;a&quot;, stock: &quot;a1&quot;, _id: &quot;oXYki3eKCIfULIge&quot;}
{dept: &quot;a&quot;, stock: &quot;a2&quot;, _id: &quot;DVvUMzpEwhtLtYxg&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, _id: &quot;k5qvFLKf7WVVr5UE&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, _id: &quot;FqMgu80gxv1DdyHs&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, _id: &quot;otJFp03djEuFX59R&quot;}
{dept: &quot;b&quot;, stock: &quot;b1&quot;, _id: &quot;lqeCPJ6k8iE2UerN&quot;}
{dept: &quot;b&quot;, stock: &quot;b2&quot;, _id: &quot;HEeGlMKvlPDj6K3x&quot;}
{dept: &quot;b&quot;, stock: &quot;b3&quot;, _id: &quot;Rab8IwKUo9s6QmK7&quot;}
{dept: &quot;b&quot;, stock: &quot;b4&quot;, _id: &quot;Ry81S3evrr0PEDs0&quot;}
{dept: &quot;b&quot;, stock: &quot;b5&quot;, _id: &quot;57cLF8GdIb9601fc&quot;}
===== clientService, dept: a, before mutations
{dept: &quot;a&quot;, stock: &quot;a1&quot;, ___id: &quot;oXYki3eKCIfULIge&quot;, _id: &quot;zNMAs3M5qVunSIhj&quot;}
{dept: &quot;a&quot;, stock: &quot;a2&quot;, ___id: &quot;DVvUMzpEwhtLtYxg&quot;, _id: &quot;xJYNmY5NCWtDywTg&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, ___id: &quot;k5qvFLKf7WVVr5UE&quot;, _id: &quot;dDV0PDLmQFonckzj&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, ___id: &quot;FqMgu80gxv1DdyHs&quot;, _id: &quot;enSfMT2c9tGKLXFr&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, ___id: &quot;otJFp03djEuFX59R&quot;, _id: &quot;tkDySDQP5P0XTzcn&quot;}
</code></pre>
<p>We can simulate other people changing data on the remote service.</p>
<pre><code class="lang-text">===== mutate remoteService
remoteService.patch stock: a1 move to dept: b
remoteService.patch stock: b1 move to dept: a
</code></pre>
<p>The mutations are replicated to the client.</p>
<pre><code class="lang-text">===== remoteService, after mutations
{dept: &quot;b&quot;, stock: &quot;a1&quot;, _id: &quot;oXYki3eKCIfULIge&quot;}
{dept: &quot;a&quot;, stock: &quot;a2&quot;, _id: &quot;DVvUMzpEwhtLtYxg&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, _id: &quot;k5qvFLKf7WVVr5UE&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, _id: &quot;FqMgu80gxv1DdyHs&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, _id: &quot;otJFp03djEuFX59R&quot;}
{dept: &quot;a&quot;, stock: &quot;b1&quot;, _id: &quot;lqeCPJ6k8iE2UerN&quot;}
{dept: &quot;b&quot;, stock: &quot;b2&quot;, _id: &quot;HEeGlMKvlPDj6K3x&quot;}
{dept: &quot;b&quot;, stock: &quot;b3&quot;, _id: &quot;Rab8IwKUo9s6QmK7&quot;}
{dept: &quot;b&quot;, stock: &quot;b4&quot;, _id: &quot;Ry81S3evrr0PEDs0&quot;}
{dept: &quot;b&quot;, stock: &quot;b5&quot;, _id: &quot;57cLF8GdIb9601fc&quot;}
===== clientService, dept a, after mutations
{dept: &quot;a&quot;, stock: &quot;a2&quot;, ___id: &quot;DVvUMzpEwhtLtYxg&quot;, _id: &quot;xJYNmY5NCWtDywTg&quot;}
{dept: &quot;a&quot;, stock: &quot;a3&quot;, ___id: &quot;k5qvFLKf7WVVr5UE&quot;, _id: &quot;dDV0PDLmQFonckzj&quot;}
{dept: &quot;a&quot;, stock: &quot;a4&quot;, ___id: &quot;FqMgu80gxv1DdyHs&quot;, _id: &quot;enSfMT2c9tGKLXFr&quot;}
{dept: &quot;a&quot;, stock: &quot;a5&quot;, ___id: &quot;otJFp03djEuFX59R&quot;, _id: &quot;tkDySDQP5P0XTzcn&quot;}
{dept: &quot;a&quot;, stock: &quot;b1&quot;, ___id: &quot;lqeCPJ6k8iE2UerN&quot;, _id: &quot;iYgsqQbCaS9IH78p&quot;}
===== Example finished.
</code></pre>
<p>The <code>stock: &quot;a1&quot;</code> record was removed from the client service because it no longer satisfied
the publication after mutation.
The <code>stock: &quot;b1&quot;</code> record was added as its mutation caused it to now satisfied the publication.</p>
<h2 id="filter-service-events-on-server">Filter service events on server</h2>
<p>The client service will contain those records on the remote service
which satisfy a publication&apos;s criteria.
The server determines which service events are applicable for each client,
and only emits the relevant ones.</p>
<h5 id="server-code">Server code</h5>
<p>Attach hooks to each remote service:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// No change from previous example</span>
<span class="hljs-keyword">const</span> { client } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
app.hooks({ before: client(<span class="hljs-string">&apos;_offline&apos;</span>) });
</code></pre>
<p>Startup server publication filters:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// New code</span>
<span class="hljs-keyword">const</span> { serverOfflineFirst } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/server&apos;</span>);
<span class="hljs-keyword">const</span> commonPublications = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/common/commonPublications&apos;</span>);

serverOfflineFirst(app, [<span class="hljs-string">&apos;remote-service&apos;</span>], { publications: commonPublications });
</code></pre>
<h5 id="client-code">Client code</h5>
<p>Attach a hook to each local service:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// No change from previous example</span>
<span class="hljs-keyword">const</span> { client } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
<span class="hljs-built_in">module</span>.exports = { before: { all: client(<span class="hljs-string">&apos;_offline&apos;</span>) } };
</code></pre>
<p>Configure the replication, with a publication to identify the desired records, and then start it:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// One line change from previous example</span>
<span class="hljs-keyword">const</span> commonPublications = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/common/commonPublications&apos;</span>);
<span class="hljs-keyword">const</span> realtime = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/realtime&apos;</span>);

<span class="hljs-keyword">const</span> replicator = realtime({
  name: <span class="hljs-string">&apos;foo&apos;</span>,
  app: clientApp,
  remoteServiceName: <span class="hljs-string">&apos;remote-service&apos;</span>,
  clientServiceName: <span class="hljs-string">&apos;client-service&apos;</span>,
  publication: {
    <span class="hljs-built_in">module</span>: commonPublications, name: <span class="hljs-string">&apos;query&apos;</span>, params: { dept: <span class="hljs-string">&apos;a&apos;</span> },
    ifServer: <span class="hljs-literal">true</span>, checkBefore: <span class="hljs-literal">true</span> <span class="hljs-comment">// new line</span>
  },
});

replicator.subscribe()
  .then(() =&gt; ...)
</code></pre>
<h5 id="example">Example</h5>
<p>You can run an example using this strategy.</p>
<pre><code class="lang-text">cd path/to/feathers-mobile/examples
npm install
cd ./realtime-3
npm run build
npm start
</code></pre>
<p>Then point a browser at <code>localhost:3030</code>.</p>
<p>The client log for this strategy is the same as for the previous one,
However the server log shows that the server is now checking the publications
and emitting only the relevant ones.</p>
<pre><code class="lang-text">rep:filter --- filter patch +0ms
rep:filter from { dept: &apos;a&apos;, stock: &apos;a1&apos;, _id: &apos;SOmYFH8pzebSWL6x&apos; } +3ms
rep:filter to   { dept: &apos;b&apos;, stock: &apos;a1&apos;, _id: &apos;SOmYFH8pzebSWL6x&apos; } +3ms
rep:filter NEED true false +1ms
rep:filter --- filter patch +7ms
rep:filter from { dept: &apos;b&apos;, stock: &apos;b1&apos;, _id: &apos;sWTybSEdfXm8NQpu&apos; } +1ms
rep:filter to   { dept: &apos;a&apos;, stock: &apos;b1&apos;, _id: &apos;sWTybSEdfXm8NQpu&apos; } +0ms
rep:filter NEED false true +1ms
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="browsers-mobile-devices.html" class="navigation navigation-prev " aria-label="Previous page: Browsers & mobile devices">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="realtime-examples.html" class="navigation navigation-next " aria-label="Next page: Realtime examples">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Realtime setup","level":"1.5.10","depth":2,"next":{"title":"Realtime examples","level":"1.5.11","depth":2,"path":"offline/realtime-examples.md","ref":"offline/realtime-examples.md","articles":[]},"previous":{"title":"Browsers & mobile devices","level":"1.5.9","depth":2,"path":"offline/browsers-mobile-devices.md","ref":"offline/browsers-mobile-devices.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["feathers-collapsible-menu","heading-anchors","include-codeblock"],"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"highlight":{},"include-codeblock":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"feathers-collapsible-menu":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"offline/realtime-setup.md","mtime":"2017-05-18T15:21:41.007Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-05-18T15:22:05.600Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-feathers-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

