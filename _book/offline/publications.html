
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Publications Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="filtering.html" />
    
    
    <link rel="prev" href="database-records.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../step-by-step/readme.html">
            
                <a href="../step-by-step/readme.html">
            
                    
                    Step by step intro to basic Feathers >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../step-by-step/intro/readme.html">
            
                <a href="../step-by-step/intro/readme.html">
            
                    
                    Introduction >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../step-by-step/intro/not-worry.html">
            
                <a href="../step-by-step/intro/not-worry.html">
            
                    
                    What not to worry about
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../step-by-step/basic-feathers/readme.html">
            
                <a href="../step-by-step/basic-feathers/readme.html">
            
                    
                    Basic Feathers >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../step-by-step/basic-feathers/database-connector.html">
            
                <a href="../step-by-step/basic-feathers/database-connector.html">
            
                    
                    A database connector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../step-by-step/basic-feathers/rest-api-server.html">
            
                <a href="../step-by-step/basic-feathers/rest-api-server.html">
            
                    
                    A REST API server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../step-by-step/basic-feathers/rest-client.html">
            
                <a href="../step-by-step/basic-feathers/rest-client.html">
            
                    
                    A Feathers REST client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../step-by-step/basic-feathers/socket-client.html">
            
                <a href="../step-by-step/basic-feathers/socket-client.html">
            
                    
                    A Feathers websocket client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../step-by-step/basic-feathers/ah-ha.html">
            
                <a href="../step-by-step/basic-feathers/ah-ha.html">
            
                    
                    The "ah-ha" moment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../step-by-step/basic-feathers/hooks-1.html">
            
                <a href="../step-by-step/basic-feathers/hooks-1.html">
            
                    
                    Hooks, part 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.7" data-path="../step-by-step/basic-feathers/hooks-2.html">
            
                <a href="../step-by-step/basic-feathers/hooks-2.html">
            
                    
                    Hooks, part 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.8" data-path="../step-by-step/basic-feathers/real-time.html">
            
                <a href="../step-by-step/basic-feathers/real-time.html">
            
                    
                    Real-time
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../step-by-step/generators/readme.html">
            
                <a href="../step-by-step/generators/readme.html">
            
                    
                    Generators >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../step-by-step/generators/app.html">
            
                <a href="../step-by-step/generators/app.html">
            
                    
                    Generating an app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../step-by-step/generators/service.html">
            
                <a href="../step-by-step/generators/service.html">
            
                    
                    Adding a service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../step-by-step/what-next.html">
            
                <a href="../step-by-step/what-next.html">
            
                    
                    What's next?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../step-by-step/production-ready.html">
            
                <a href="../step-by-step/production-ready.html">
            
                    
                    Is Feathers production ready?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../step-by-step/appendix/readme.html">
            
                <a href="../step-by-step/appendix/readme.html">
            
                    
                    Appendix >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../step-by-step/appendix/what-is-this.html">
            
                <a href="../step-by-step/appendix/what-is-this.html">
            
                    
                    What is 'this'?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../chat/readme.html">
            
                <a href="../chat/readme.html">
            
                    
                    Writing a chat room app >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../chat/server/readme.html">
            
                <a href="../chat/server/readme.html">
            
                    
                    Server >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../chat/server/start-server.html">
            
                <a href="../chat/server/start-server.html">
            
                    
                    Starting the server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../chat/server/start-front-end.html">
            
                <a href="../chat/server/start-front-end.html">
            
                    
                    Starting the front-end
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../chat/server/finish-server.html">
            
                <a href="../chat/server/finish-server.html">
            
                    
                    Finishing the server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../chat/server/user-mgnt.html">
            
                <a href="../chat/server/user-mgnt.html">
            
                    
                    User management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../chat/client/readme.html">
            
                <a href="../chat/client/readme.html">
            
                    
                    Client >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../chat/client/jQuery.html">
            
                <a href="../chat/client/jQuery.html">
            
                    
                    jQuery client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../chat/client/webpack.html">
            
                <a href="../chat/client/webpack.html">
            
                    
                    Using Webpack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../chat/client/oauth.html">
            
                <a href="../chat/client/oauth.html">
            
                    
                    OAuth jQuery client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../chat/client/other-clients.html">
            
                <a href="../chat/client/other-clients.html">
            
                    
                    Clients for other frameworks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../chat/what-next.html">
            
                <a href="../chat/what-next.html">
            
                    
                    What's next?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../adapters/readme.html">
            
                <a href="../adapters/readme.html">
            
                    
                    Adapters >>
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../adapters/redux-services/readme.html">
            
                <a href="../adapters/redux-services/readme.html">
            
                    
                    Redux for Feathers services >>
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../adapters/redux-auth/readme.html">
            
                <a href="../adapters/redux-auth/readme.html">
            
                    
                    Redux for Feathers authentication >>
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    Offline
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="strategies.html">
            
                <a href="strategies.html">
            
                    
                    Strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="snapshot.html">
            
                <a href="snapshot.html">
            
                    
                    snapshot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="realtime.html">
            
                <a href="realtime.html">
            
                    
                    realtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="owndata-ownnet.html">
            
                <a href="owndata-ownnet.html">
            
                    
                    own-data & own-net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="syncdata-syncnet.html">
            
                <a href="syncdata-syncnet.html">
            
                    
                    sync-data & sync-net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="database-records.html">
            
                <a href="database-records.html">
            
                    
                    Database records
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.7" data-path="publications.html">
            
                <a href="publications.html">
            
                    
                    Publications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="filtering.html">
            
                <a href="filtering.html">
            
                    
                    Filtering service events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="browsers-mobile-devices.html">
            
                <a href="browsers-mobile-devices.html">
            
                    
                    Browsers & mobile devices
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Publications</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="publications">Publications</h1>
<p>The local service will replicate the entire remote service by default.
You may replicate only a subset of the remote service records using <strong>publications</strong>.</p>
<h2 id="publication-functions">Publication functions</h2>
<p>A <code>publication</code> is a function which, given a record,
indicates if it belongs to the subset of records the publication identifies.
For example a publication could select all the records belonging to a specific user.</p>
<p>The publication function, if one is provided, will always run on the client.
It will identify service events which are relevant to the publication.</p>
<p>The publication function optionally runs on the server
to reduce the number of service events sent the client.
This may potentially result in better throughput.</p>
<p>Here is a <code>publications</code> object containing two <code>publication</code> functions:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { query } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/common/commonPublications&apos;</span>);

publications = {
  userData: username =&gt; (data, connection, hook) =&gt; data.username === username,

  query
};
</code></pre>
<p>The <code>userData</code> publication identifies the subset of records belonging to the provided <code>username</code>.
You might use a publication like this in an app where each user has their own compartmentalized data
which other users cannot see.
This would allow the records for all users to be kept in one table
rather than using a separate table for each user.</p>
<p>The <code>query</code> publication is one provided with offline-first,
and you are likely to use it often.
It tests records with <a href="http://docs.mongodb.org/manual/reference/operator/query/" target="_blank">MongoDB queries</a>.</p>
<p>Features:</p>
<ul>
<li>Supported operators: $in, $nin, $exists, $gte, $gt, $lte, $lt, $eq, $ne, $mod, $all, $and, $or,
$nor, $not, $size, $type, $regex, $where, $elemMatch</li>
<li>Regexp searches</li>
<li>sub object searching</li>
<li>dot notation searching</li>
</ul>
<p>Publications are passed only the <code>data</code> object when they are run on the client.
They are additionally passed the <code>connection</code> and <code>hook</code> objects when they are run as
<a href="https://docs.feathersjs.com/api/events.html#event-filtering" target="_blank">service event filters</a>
on the server.</p>
<h2 id="publications-on-the-client">Publications on the client</h2>
<p>We will discuss later how to start a replication on the client.
However let&apos;s continue out our discussion by briefly looking
at the replicator&apos;s <code>publication</code> option.</p>
<p>We could replicate only records belonging to one user using the publications object
we wrote above.</p>
<pre><code class="lang-javascript">publication: { <span class="hljs-built_in">module</span>: publications, name: <span class="hljs-string">&apos;userData&apos;</span>, params: [username], ifServer: <span class="hljs-literal">true</span>, checkBefore: <span class="hljs-literal">false</span> }
</code></pre>
<p>This would call the publication function using
<code>publications.userData(...params)(data, connection, hook)</code>.</p>
<p>Assuming the record layout had a <code>dept</code> field,
we could replicate only the records for the accounting department with:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> commonPublications = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-mobile/lib/common/commonPublications&apos;</span>);
...
publication: { <span class="hljs-built_in">module</span>: commonPublications, name: <span class="hljs-string">&apos;query&apos;</span>, params: { dept: <span class="hljs-string">&apos;acct&apos;</span> } }
</code></pre>
<h2 id="publications-on-the-server">Publications on the server</h2>
<p>The server is automatically informed of
which publication each client is using for each remote service.
Furthermore the server components of offline-first can configure
<a href="https://docs.feathersjs.com/api/events.html#event-filtering" target="_blank">service event filters</a>
to control the events sent to each client.</p>
<p>We can see that both the client and the server are likely <code>require</code> the same <code>publications</code> object.
So its best to keep these in a directory that can be shared between the client and server code.
That&apos;s why the <code>feathers-mobile/lib/common/commonPublications</code> path contains a <code>common</code> directory.</p>
<h2 id="publications-with-server-hooks">Publications with server hooks</h2>
<p>Information about the current client&apos;s publication for a remote service is available
to the hooks that run for that service.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="database-records.html" class="navigation navigation-prev " aria-label="Previous page: Database records">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="filtering.html" class="navigation navigation-next " aria-label="Next page: Filtering service events">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Publications","level":"1.5.7","depth":2,"next":{"title":"Filtering service events","level":"1.5.8","depth":2,"path":"offline/filtering.md","ref":"offline/filtering.md","articles":[]},"previous":{"title":"Database records","level":"1.5.6","depth":2,"path":"offline/database-records.md","ref":"offline/database-records.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["feathers-collapsible-menu","heading-anchors","include-codeblock"],"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"highlight":{},"include-codeblock":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"feathers-collapsible-menu":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"offline/publications.md","mtime":"2017-05-15T18:56:19.121Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-05-16T14:00:51.099Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-feathers-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

